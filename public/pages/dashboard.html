<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/dashboard/servers.css">
    <title>ARGUS | Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <header class="desktopNav">
        <img class="logo" src="../assets/icon/logoBranca.svg" alt="">
        <div class="alerts">
            <div class="bell">
                <img src="../assets/dashboard/desktop/bell.svg" alt="">
            </div>
            <div class="risk">0</div>
            <div class="atention">0</div>
        </div>
        <div class="server">
            <div class="serverSelect">   
                <img src="../assets/dashboard/desktop/server.svg" alt="">
                <select name="servers" id="servers">
                    <option value="server1" title="CPU 3.0 GHz (8 cores), 64 GB RAM, RTX 3080 Ti, NVMe 2 TB, 10 GbE">Servidor 1</option>
                    <option value="server2" title="CPU 3.2 GHz (12 cores), 128 GB RAM, RTX 4090, NVMe 4 TB, 25 GbE">Servidor 2</option>
                    <option value="server3" title="CPU 3.8 GHz (32 cores), 512 GB RAM, NVIDIA A100 80 GB, NVMe 16 TB, 100 GbE">Servidor 3</option>
                </select>
            </div>
            <div class="serverSpecs"></div>
        </div>
    </header>

    <div class="KPIs">
        <div>
           <canvas id="cpuGauge"></canvas>
        </div>
        <div>
           <canvas id="memoryGauge"></canvas>
        </div>
        
        <div>
           <canvas id="gpuGauge"></canvas>
        </div>
        
        <div>
           <canvas id="storageGauge"></canvas>
        </div>
        
        <div>
           <canvas id="latencyGauge"></canvas>
        </div>
    </div>
</body>
</html>

<script>
const select = document.getElementById("servers");
const serverSpecs = document.querySelector(".serverSpecs");

serverSpecs.textContent = select.options[select.selectedIndex].title;

select.addEventListener("change", function () {
    const selectedOption = select.options[select.selectedIndex];
    serverSpecs.textContent = selectedOption.title;
});

// Criar os gráficos
function createGauge(chartId, title, usage, total, unit, usedText, temperature, differentColors = null) {
    const ctx = document.getElementById(chartId).getContext('2d');
    
    const tempIcon = new Image();
    tempIcon.src = '../assets/dashboard/desktop/heat.svg';
    
    const usedValue = differentColors ? (usage/100) * differentColors : (total * usage/100).toFixed(1);
    
    return new Chart(ctx, {
        type: 'doughnut',
        data: {
            datasets: [{
                data: [usage, 200 - usage],
                backgroundColor: [
                    usage < 60 ? "green" : usage < 85 ? "#ffde59" : "#ff3131",
                    "#333"
                ],
                borderWidth: 0,
                cutout: "90%"
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            rotation: -90,
            circumference: 360,
            plugins: {
                tooltip: { enabled: false },
                legend: { display: false },
                title: {
                    display: true,
                    text: title,
                    color: "#fff",
                    font: { size: 16, family: "Cairo, Arial, sans-serif", weight: "bold" }
                }
            }
        },
        plugins: [{
            id: 'text',
            beforeDraw: (chart) => {
                const {ctx, chartArea: {width, height}} = chart;
                ctx.save();
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                const centerX = width / 2;
                const centerY = height / 2;
                const baseFontSize = width / 10;
                
                // Texto principal
                ctx.fillStyle = "#fff";
                ctx.font = `bold ${baseFontSize}px Cairo`;
                ctx.fillText(usage + "%", centerX, centerY - height*0.015);
                
                // Texto secundário
                ctx.font = `${baseFontSize / 2}px Cairo`;
                
                if (differentColors) {
                    ctx.fillText(usedValue.toFixed(2) + " de " + differentColors + " " + usedText, centerX, centerY + height*0.15);
                } else {
                    ctx.fillText(usedValue + unit + " de " + total + unit + " " + usedText, centerX, centerY + height*0.15);
                }
                
                // Temperatura
                let tempColor;
                if (temperature < 50) tempColor = "#32CD32";
                else if (temperature < 70) tempColor = "#FFD700";
                else tempColor = "#FF4500";
                ctx.fillStyle = tempColor;
                
                const tempText = temperature + "°C";
                ctx.font = `bold ${baseFontSize / 1.3}px Cairo`;
                
                const textWidth = ctx.measureText(tempText).width;
                const iconSize = baseFontSize / 1.3;
                const totalWidth = textWidth + iconSize + 5; 
                
                const startX = centerX - totalWidth / 1.8;
                
                if (tempIcon.complete) {
                    ctx.drawImage(tempIcon, startX, centerY + height*0.38 - iconSize/0.8, iconSize-5, iconSize+10);
                }
                
                ctx.fillText(tempText, startX + iconSize + 5 + textWidth/2, centerY + height*0.35);
                
                ctx.restore();
            }
        }]
    });
}

document.addEventListener('DOMContentLoaded', function() {
    createGauge('cpuGauge', 'CPU em Uso', 50, 8, ' cores', 'em uso', 82, 8);
    createGauge('memoryGauge', 'Memória em Uso', 45, 64, 'GB', 'usados', 65);
    createGauge('gpuGauge', 'GPU em Uso', 60, 12, 'GB', 'VRAM usados', 78);
    createGauge('storageGauge', 'Armazenamento', 75, 2, 'TB', 'usados', 48);
    createGauge('latencyGauge', 'Latência', 15, 100, 'ms', 'de ping', 42);

    document.querySelectorAll('canvas').forEach(canvas => {
        canvas.style.width = '100%';
        canvas.style.height = 'auto';
    });
});
</script>