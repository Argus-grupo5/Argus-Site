<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../css/dashboard/dashboard.css">
    <link rel="stylesheet" href="../../css/dashboard/servers.css">
    <link rel="stylesheet" href="../../css/dashboard/popup.css">
    <link rel="stylesheet" href="../../css/style.css">
    <script src="script/dash.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <title>ARGUS | Dashboard</title>
</head>

<body>
    <div id="id_sair">
    </div>

    <header class="desktopNav" id="navDesktop"></header>

    <header class="headerTop">
        <div class="geralInfo">
            <div class="info tooltipInfo">
                <div class="server">
                    <img src="../../assets/dashboard/desktop/server.svg" alt="">
                </div>
                <div class="serversMonitoring" id="id_servidores_monitorados">
                </div>
                <span class="tooltiptextInfo">
                    Servidores em monitoramento
                </span>
            </div>
            <div class="info">
                <div class="bell">
                    <img src="../../assets/dashboard/desktop/bell.svg" alt="">
                </div>
                <div class="risk tooltipInfo" id="id_servidores_em_estado_critico">
                    <p id="qtd_critico"></p>
                    <span class="tooltiptextInfo">
                        Servidores em atenção
                    </span>
                </div>
                <div class="atention tooltipInfo" id="id_servidores_em_estado_de_alerta">
                    <p id="qtd_alerta"></p>
                    <span class="tooltiptextInfo">
                        Servidores em alerta
                    </span>
                </div>
            </div>
        </div>
    </header>
    <div class="KPIs">
        <div>
            <canvas id="cpuGauge"></canvas>
        </div>
        <div>
            <canvas id="memoryGauge"></canvas>
        </div>

        <div>
            <canvas id="gpuGauge"></canvas>
        </div>

        <div>
            <canvas id="storageGauge"></canvas>
        </div>

        <div>
            <canvas id="latencyGauge"></canvas>
        </div>
    </div>
    <div class="infoGraficoSelecionado">
        <div class="graficoSelecionado">
            <div class="titulosGrafico">
                <div class="case1">
                    <div class="tituloGrafico">CPU</div>
                    <div class="subtituloGrafico">100</div>
                </div>
                <div class="case2">
                    <div class="especGrafico">RyzenX-9750K UltraBurst</div>
                    <div class="subtituloGrafico" id="respostaEspec">% de utilização</div>
                </div>
            </div>
            <div class="grafico">
                <canvas id="graficoServidor"></canvas>
            </div>
        </div>
        <div class="infoGrafico">
            <div class="caixaInformacoes">
                <div class="caixa1">
                    <div class="titulos1Caixa1">
                        <div class="box">
                            <div class="titulosBox">Utilização</div>
                            <div class="respostaTitulos">49%</div>
                        </div>
                        <div class="box">
                            <div class="titulosBox">Velocidade</div>
                            <div class="respostaTitulos">2,73 GHz</div>
                        </div>
                    </div>
                    <div class="titulos2Caixa1">
                        <div class="box">
                            <div class="titulosBox">Processos</div>
                            <div class="respostaTitulos">266</div>
                        </div>
                        <div class="box">
                            <div class="titulosBox">Threads</div>
                            <div class="respostaTitulos">4072</div>
                        </div>
                        <div class="box">
                            <div class="titulosBox">Identificadores</div>
                            <div class="respostaTitulos">134021</div>
                        </div>
                    </div>
                    <div class="titulos3Caixa1">
                        <div class="box">
                            <div class="titulosBox">Tempo de atividade</div>
                            <div class="respostaTitulos">11:13:38:01</div>
                        </div>
                    </div>
                </div>
                <div class="caixa2">
                    <div class="caixa2-box">
                        <div class="labelCaixa2">
                            <div class="label">Velocidade base: </div>
                            <div class="respostaLabel"> 2,11 Ghz</div>
                        </div>
                        <div class="labelCaixa2">
                            <div class="label">Sockets: </div>
                            <div class="respostaLabel">1</div>
                        </div>
                        <div class="labelCaixa2">
                            <div class="label">Núcleos</div>
                            <div class="respostaLabel">4</div>
                        </div>
                        <div class="labelCaixa2">
                            <div class="label">Processadores lógicos:</div>
                            <div class="respostaLabel">8</div>
                        </div>
                        <div class="labelCaixa2">
                            <div class="label">Virtualização</div>
                            <div class="respostaLabel">Habilitado</div>
                        </div>
                        <div class="labelCaixa2">
                            <div class="label">Cache L1</div>
                            <div class="respostaLabel">256 KB</div>
                        </div>
                        <div class="labelCaixa2">
                            <div class="label">Cache L2</div>
                            <div class="respostaLabel">1,0 MB</div>
                        </div>
                        <div class="labelCaixa2">
                            <div class="label">Cache L3</div>
                            <div class="respostaLabel">6,0 MB</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
<!-- Grafico servidores -->
<script>
  const ctx = document.getElementById('graficoServidor');
  let graficoSelecionado = 'CPU'
  let momentos = ['12:00', '12:01', '12:02', '12:03', '12:04', '12:05'];
  let dados = [10, 48, 26, 35, 47, 70]
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: momentos,
      datasets: [{
        label: '% Utilização ' + graficoSelecionado,
        data: dados,
        borderWidth: 1,
        borderColor: ["#FF6D4D"],
        backgroundColor: ["#FF6D4D"],
        fill: true,
        tension: 0.0,
        pointStyle: false,
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>

<script>
    header("dashboard")
    // const select = document.getElementById("servers");
    const serverSpecs = document.querySelector(".serverSpecs");


    // select.addEventListener("change", function () {
    //     const selectedOption = select.options[select.selectedIndex];
    // });

    // Criar os gráficos
    function createGauge(chartId, title, usage, total, unit, usedText, temperature, differentColors = null) {
        const ctx = document.getElementById(chartId).getContext('2d');

        const tempIcon = new Image();
        tempIcon.src = '../../assets/dashboard/desktop/heat.svg';

        const usedValue = differentColors ? (usage / 100) * differentColors : (total * usage / 100).toFixed(1);

        return new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [usage, 200 - usage],
                    backgroundColor: [
                        usage < 60 ? "green" : usage < 85 ? "#ffde59" : "#ff3131",
                        "#333"
                    ],
                    borderWidth: 0,
                    cutout: "90%"
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                rotation: -90,
                circumference: 180,
                plugins: {
                    tooltip: { enabled: false },
                    legend: { display: false },
                    title: {
                        display: true,
                        text: title,
                        color: "#fff",
                        font: { size: 16, family: "Cairo, Arial, sans-serif", weight: "bold" },
                        padding: { top: 30 }
                    }
                }
            },
            plugins: [{
                id: 'text',
                beforeDraw: (chart) => {
                    const { ctx, chartArea: { width, height } } = chart;
                    ctx.save();
                    ctx.textAlign = "center";
                    ctx.textBaseline = "middle";
                    const centerX = width / 2;
                    const centerY = height * 0.9;
                    const baseFontSize = width / 10;

                    // Texto principal
                    ctx.fillStyle = "#fff";
                    ctx.font = `bold ${baseFontSize}px Cairo`;
                    ctx.fillText(usage + "%", centerX, centerY - height * 0.15);

                    // Texto secundário
                    ctx.font = `${baseFontSize / 2}px Cairo`;

                    if (differentColors) {
                        ctx.fillText(usedValue.toFixed(2) + " de " + differentColors + " " + usedText, centerX, centerY + height * 0.15);
                    } else {
                        ctx.fillText(usedValue + unit + " de " + total + unit + " " + usedText, centerX, centerY + height * 0.15);
                    }

                    
                    ctx.restore();
                }
            }]
        });
    }

    document.addEventListener('DOMContentLoaded', function () {
        createGauge('cpuGauge', 'CPU em Uso', 50, 8, ' cores', 'em uso', 82, 8);
        createGauge('memoryGauge', 'Memória em Uso', 45, 64, 'GB', 'usados', 65);
        createGauge('gpuGauge', 'GPU em Uso', 60, 12, 'GB', 'VRAM usados', 78);
        createGauge('storageGauge', 'Armazenamento', 75, 2, 'TB', 'usados', 48);
        createGauge('latencyGauge', 'Latência', 15, 100, 'ms', 'de ping', 42);

        document.querySelectorAll('canvas').forEach(canvas => {
            canvas.style.width = '100%';
            canvas.style.height = 'auto';
        });
    });
</script>