<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/dashboard/servers.css">
    <link rel="stylesheet" href="../css/style.css">
    <script src="../script/dash.js"></script>
    <title>ARGUS | Servidores</title>
</head>


<body>
    <div id="id_sair">
    </div>

    <header class="desktopNav">
        <div class="navButtons">
            <div class="navButton tooltipNav" id="navUser">
                <img src="../assets/dashboard/desktop/user.svg" alt="">
                <span class="tooltiptextNav">
                <div id="userNome"></div>
                <div id="userCargo">ADM</div>
                </span>
            </div>
            <a href="../pages/servers.html" class="navButton tooltipNav" id="navServers">
                <img class="selected" src="../assets/dashboard/desktop/box.svg" alt="Servidores">
                <span class="tooltiptextNav">Servidores</span>
            </a>
            
            <a href="../pages/funcionarios.html" class="navButton tooltipNav" id="navServers">
                <img src="../assets/dashboard/desktop/employes.svg" alt="Funcionários">
                <span class="tooltiptextNav">Funcionários</span>
           </a>
            <div class="navButton tooltipNav" id="navServers">
                <img src="../assets/dashboard/desktop/logs.svg" alt="Logs">
                <span class="tooltiptextNav">Logs</span>
            </div>
            <div class="navButton tooltipNav" id="navServers">
                <img src="../assets/dashboard/desktop/headphone.svg" alt="Suporte">
                <span class="tooltiptextNav">Suporte</span>
            </div>

            <div class="navButton tooltipNav" id="navServers" onclick="sair()">
                <img src="../assets/dashboard/desktop/logout.svg" alt="Sair">
                <span class="tooltiptextNav">Sair</span>
            </div>

        </div>
        <img class="logo" src="../assets/icon/logoBlack.svg" alt="">
    </header>

    <header class="headerTop">
        <div class="user">
            <img src="../assets/dashboard/desktop/user.svg" alt="">
            <div class="userInfo">
                <div id="userNome"></div>
                <div id="userCargo">ADM</div>
            </div>
        </div>
        <div class="geralInfo">
            <div class="info tooltipInfo">
                <div class="server">
                    <img src="../assets/dashboard/desktop/server.svg" alt="">
                </div>
                <div class="serversMonitoring" id="id_servidores_monitorados">
                </div>
                <span class="tooltiptextInfo">
                    Servidores em monitoramento
                </span>
            </div>
            <div class="info">
                <div class="bell">
                    <img src="../assets/dashboard/desktop/bell.svg" alt="">
                </div>
                <div class="risk tooltipInfo" id="id_servidores_em_estado_critico">
                    <p id="qtd_critico"></p>
                    <span class="tooltiptextInfo">
                        Servidores em atenção
                    </span>
                </div>
                <div class="atention tooltipInfo" id="id_servidores_em_estado_de_alerta">
                    <p id="qtd_alerta"></p>
                    <span class="tooltiptextInfo">
                        Servidores em alerta
                    </span>
                </div>
            </div>
        </div>
    </header>

    <div class="search">
        <select id="id_filter" onchange="filtragem_Servidores()">
            <option value="Nivel_d" selected>Nível (Decrescente)</option>
            <option value="Nivel_c">Nível (Crescente)</option>
            <option value="Critico_d">Crítico (Decrescente)</option>
            <option value="Critico_c">Crítico (Crescente)</option>
            <option value="Alerta_d">Alerta (Decrescente)</option>
            <option value="Alerta_c">Alerta (Crescente)</option>
            <option value="Bom">Bom Estado</option>
        </select>
        <input type="search" id="id_pesquisa" placeholder="Pesquisar por um servidor" oninput="filtragem_Servidores()">
    </div>

    <div class="container">
        <div class="serverInfo">
            <div class="serverIcon tooltipInfo">
                <img style="width: 2vw;" src="../assets/dashboard/desktop/tip.svg" alt="Informação sobre os dados">
                <span class="tooltiptextInfo">
                    Dados são atualizados a cada 60s
                </span>
            </div>
            <div class="serverName">
                Servidor
            </div>
            <div class="serverStatus">
                Nível de Risco
            </div>
            <div class="serverComponents">
                Recursos em Risco
            </div>
            <div class="serverLocation">
                Localização
            </div>
        </div>
        <div class="server-list" id="id_server_list">
        </div>
        </div>
    </div>
</body>


</html>

<script>
    server = [{
    server = [{
        "name": "Servidor Geforce Now",
        "nivel": "4",
        "recursos": "[CPU, RAM]",
        "localizacao": "São Paulo - SP"
    },
    {
        "name": "Servidor SPTech",
        "nivel": "3",
        "recursos": "[CPU, GPU]",
        "localizacao": "São Paulo - SP"
    }, {
    }, {
        "name": "Servidor BandTec",
        "nivel": "5",
        "recursos": "[CPU, GPU, Armazenamento]",
        "localizacao": "São Paulo - SP"
    }, {
    }, {
        "name": "Servidor Xbox",
        "nivel": "1",
        "recursos": "[Nenhum]",
        "localizacao": "Rio de Janeiro - RJ"
    },
    {
        "name": "Servidor Stadia",
        "nivel": "2",
        "recursos": "[CPU, RAM]",
        "localizacao": "Belo Horizonte - MG"
    }]

    id_servidores_monitorados.innerHTML = server.length;
    let qtd_servidores_critico = 0;
    let qtd_servidores_alerta = 0;


    for (let i = 0; i < server.length; i++) {
        if (server[i].nivel == 2 || server[i].nivel == 3) {
        if (server[i].nivel == 2 || server[i].nivel == 3) {
            qtd_servidores_alerta++;
        } else if (server[i].nivel > 3) {
        } else if (server[i].nivel > 3) {
            qtd_servidores_critico++;
        }
    }
    }

    qtd_critico.innerHTML = qtd_servidores_critico;
    qtd_alerta.innerHTML = qtd_servidores_alerta;


    let nivel_de_risco;
    let status;

    function calculate_risk(id_server) {
        let nivel = Number(server[id_server].nivel);
        if (nivel == 1) {
            status = "ok";
        } else if (nivel > 1 && nivel <= 3) {
            status = "atention";
        } else if (nivel >= 4) {
            status = "danger";
        } else {
            status = "Inválido";
        }
        return status;
    }
    function gerar_server(id_server) {
        let status = calculate_risk(id_server);
        id_server_list.innerHTML += `            
            <div class="server-object">
                <div class="serverIcon tooltipInfo">
                    <img class="server-icon-status" src="../assets/dashboard/desktop/${status}.svg" alt="Status do servidor">
                </div>
                <div class="serverName">
                    ${server[id_server].name}
                </div>
                <div class="serverStatus">
                    <progress value="${server[id_server].nivel}" max="5"></progress>
                </div>
                <div class="serverComponents">
                    ${server[id_server].recursos}
                </div>
                <div class="serverLocation">
                    ${server[id_server].localizacao}
                </div>
            </div>`;
    }
    function filtragem_Servidores() {
        let filtro = document.getElementById("id_filter").value;
        let pesquisa = document.getElementById("id_pesquisa").value.toLowerCase();

        id_server_list.innerHTML = "";

        if (filtro == "Nivel_c" || filtro == "Critico_c" || filtro == "Alerta_c") {
            server.sort((a, b) => a.nivel - b.nivel);
        } else if (filtro == "Nivel_d" || filtro == "Critico_d" || filtro == "Alerta_d") {
            server.sort((a, b) => b.nivel - a.nivel);
        }

        for (let i = 0; i < server.length; i++) {
            let status = calculate_risk(i);

            let passouFiltroEstado =
                (filtro == "Critico_c" && status == "danger" || filtro == "Critico_d" && status == "danger") ||
                (filtro == "Alerta_c" && status == "atention" || filtro == "Alerta_d" && status == "atention") ||
                (filtro == "Bom" && status == "ok") ||
                (filtro == "Nivel_c" || filtro == "Nivel_d");

            let passouFiltroPesquisa =
                server[i].name.toLowerCase().includes(pesquisa) ||
                server[i].localizacao.toLowerCase().includes(pesquisa) ||
                server[i].recursos.toLowerCase().includes(pesquisa);

            if (passouFiltroEstado && passouFiltroPesquisa) {
                gerar_server(i);
            }
        }
    }





    filtragem_Servidores();

    function sair() {
    function sair() {
        id_sair.innerHTML = `
        
            <div class="popup_sair">
                <h1>Deseja sair?</h1>
                <button onclick="sair_s()">Sim</button>
                <button onclick="sair_n()">Não</button>
            </div>
        `;
    }

    function sair_s() {
    function sair_s() {
        window.location.href = "./login.html";
        sessionStorage.clear;
    }

    function sair_n() {
    function sair_n() {
        id_sair.innerHTML = ``;
    }

    userNome.innerHTML = sessionStorage.USER_NAME;
    userCargo.innerHTML = sessionStorage.CARGO_CARGO;
</script>